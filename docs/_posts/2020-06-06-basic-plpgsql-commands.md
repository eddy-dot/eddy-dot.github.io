---
title: "PL/pgSQL Tutorial"
date: 2020-06-06T21:57:40+08:00
categories:
  - Blog
tags:
  - Database
  - Postgres
---

# Basic PL/PGSQL Commands

> PL/pgSQL is a procedural programming language supported by the PostgreSQL ORDBMS. It closely resembles Oracle's PL/SQL language. The design of PL/pgSQL aimed to allow PostgreSQL users to perform more complex operations and computations than SQL, while providing ease of use.

## 1. Create Function

###    1a. Create SQL function

```sql
CREATE OR REPLACE FUNCTION test() RETURNS void AS $$ 
INSERT INTO mytable VALUES (30),(50) 
$$ LANGUAGE sql;
```

###    1b.  Create PL/PGSQL function
```sql
CREATE OR REPLACE FUNCTION demo ()
RETURNS text AS $$
BEGIN
PERFORM test();
RETURN ’OK’;
END;
$$ LANGUAGE plpgsql;
```
###    1c.  Call Function
```sql
EXECUTE demo();
```

## 2.  Create procedure

###    2a. Create test table “Accounts”

```sql
drop table if exists accounts;

create table accounts (
    id int generated by default as identity,
    name varchar(100) not null,
    balance dec(15,2) not null,
    primary key(id)
);
```
###    2b. Insert demo values
```sql
insert into accounts(name,balance)
values('Bob',10000);

insert into accounts(name,balance)
values('Alice',10000);
```
###    2c. Check Table data
```sql    
select * from accounts;
```
###    2d. Create Procedure
```sql    
create or replace procedure transfer(
   sender int,
   receiver int, 
   amount dec
)
language plpgsql    
as $$
begin
    -- subtracting the amount from the sender's account 
    update accounts 
    set balance = balance - amount 
    where id = sender;

    -- adding the amount to the receiver's account
    update accounts 
    set balance = balance + amount 
    where id = receiver;

    commit;
end;$$
```   
###    2e. Call Procedure

```sql
call transfer(1,2,1000);
```
###    2f. Check Table
```sql
SELECT * FROM accounts;
```    